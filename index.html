<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Vault dApp</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6"></script>
    <style>
      body {
        background: #101010;
        color: #00ffcc;
        font-family: monospace;
        text-align: center;
        padding-top: 40px;
      }
      input, button {
        background: #202020;
        border: none;
        color: #00ffcc;
        padding: 8px 12px;
        margin: 6px;
      }
      button { cursor: pointer; }
    </style>
  </head>

  <body>
    <h2>üí∞ Vault dApp</h2>

    <button onclick="connectWallet()">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å MetaMask</button>
    <p id="status">MetaMask –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω</p>

    <hr>

    <button onclick="getBalance()">üìä –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
    <p id="balance">–ë–∞–ª–∞–Ω—Å: -</p>

    <hr>

    <input id="depositValue" placeholder="–°–∫–æ–ª—å–∫–æ –≤–Ω–µ—Å—Ç–∏ (ETH)" />
    <button onclick="deposit()">üí∏ –í–Ω–µ—Å—Ç–∏</button>

    <input id="withdrawValue" placeholder="–°–∫–æ–ª—å–∫–æ —Å–Ω—è—Ç—å (ETH)" />
    <button onclick="withdraw()">üè¶ –°–Ω—è—Ç—å</button>

    <script>
      let provider, signer, contract;

      // ====== ABI —Ç–≤–æ–µ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ ======
      const ABI = [
        {
          "inputs": [],
          "name": "deposit",
          "outputs": [],
          "stateMutability": "payable",
          "type": "function"
        },
        {
          "inputs": [{"internalType":"uint256","name":"amount","type":"uint256"}],
          "name": "withdraw",
          "outputs": [],
          "stateMutability": "nonpayable",
          "type": "function"
        },
        {
          "inputs": [{"internalType":"address","name":"user","type":"address"}],
          "name": "getBalance",
          "outputs": [{"internalType":"uint256","name":"","type":"uint256"}],
          "stateMutability": "view",
          "type": "function"
        }
      ];

      // ====== –∞–¥—Ä–µ—Å —Ç–≤–æ–µ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ ======
      const CONTRACT_ADDRESS = "0xd9145CCE52D386f254917e481eB44e9943F39138";

      async function connectWallet() {
        try {
            console.log("üîπ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...");

            if (!window.ethereum) {
            alert("–£—Å—Ç–∞–Ω–æ–≤–∏ MetaMask!");
            return;
            }

            const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
            console.log("‚úÖ –ê–∫–∫–∞—É–Ω—Ç—ã:", accounts);

            provider = new ethers.BrowserProvider(window.ethereum);
            console.log("‚úÖ Provider —Å–æ–∑–¥–∞–Ω");

            signer = await provider.getSigner();
            console.log("‚úÖ Signer:", await signer.getAddress());

            contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
            console.log("‚úÖ –ö–æ–Ω—Ç—Ä–∞–∫—Ç –ø–æ–¥–∫–ª—é—á—ë–Ω:", contract);

            document.getElementById("status").innerText = `‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω: ${accounts[0]}`;
        } catch (err) {
            console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏:", err);
            alert("–û—à–∏–±–∫–∞: " + err.message);
        }
        }


      async function getBalance() {
        if (!contract) return alert("–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏ MetaMask!");
        const addr = await signer.getAddress();
        const bal = await contract.getBalance(addr);
        document.getElementById("balance").innerText = `–ë–∞–ª–∞–Ω—Å: ${ethers.formatEther(bal)} ETH`;
      }

      async function deposit() {
        if (!contract) return alert("–ü–æ–¥–∫–ª—é—á–∏ MetaMask!");
        const val = document.getElementById("depositValue").value;
        const tx = await contract.deposit({ value: ethers.parseEther(val) });
        await tx.wait();
        alert("üí∞ –£—Å–ø–µ—à–Ω–æ –≤–Ω–µ—Å–µ–Ω–æ!");
      }

      async function withdraw() {
        if (!contract) return alert("–ü–æ–¥–∫–ª—é—á–∏ MetaMask!");
        const val = document.getElementById("withdrawValue").value;
        const tx = await contract.withdraw(ethers.parseEther(val));
        await tx.wait();
        alert("üè¶ –°–Ω—è—Ç–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!");
      }

    </script>
  </body>
</html>
